{% load static %}
<nav
  class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
  id="layout-navbar"
>
  <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
    <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
      <i class="bx bx-menu bx-sm"></i>
    </a>
  </div>

  <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
    <!-- Brand / Search placeholder -->
    <div class="navbar-nav align-items-center">
      <div class="nav-item d-flex align-items-center">
        AutoDash Car Care &amp; Detailers
      </div>
    </div>
    <!-- / Brand -->

    <ul class="navbar-nav flex-row align-items-center ms-auto">

      {# ===================== Notifications Bell ===================== #}
      <li class="nav-item dropdown">
        <a class="nav-link position-relative" href="#" id="notifDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bx bx-bell bx-sm"></i>
          {% if notif_has_unread %}
            <span class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle"
                  style="font-size:.65rem;">
              {{ notif_unread_count }}
            </span>
          {% endif %}
        </a>

        <div class="dropdown-menu dropdown-menu-end p-0" aria-labelledby="notifDropdown" style="min-width: 380px;">
          <div class="d-flex justify-content-between align-items-center px-3 py-2 border-bottom">
            <div class="fw-semibold">Notifications</div>
            <div class="d-flex gap-2">
              {# Optional: Mark all as read (POST). Make sure you have this URL/view. #}
              <form method="post" action="{% url 'notifications_mark_all_read' %}" class="m-0 p-0">
                {% csrf_token %}
                <button type="submit" class="btn btn-link btn-sm text-decoration-none">Mark all read</button>
              </form>
            </div>
          </div>

          <div class="list-group list-group-flush" style="max-height: 380px; overflow:auto;">
            {% if notif_latest_unread %}
              {% for n in notif_latest_unread %}
                <a href="{{ n.target_url|default:'#' }}"
                   class="list-group-item list-group-item-action">
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">{{ n.title }}</h6>
                    <small class="text-muted">{{ n.created_at|date:"Y-m-d H:i" }}</small>
                  </div>
                  <div class="d-flex justify-content-between">
                    <form method="post" action="{% url 'notification_mark_read' n.id %}">
                      {% csrf_token %}
                      <button class="btn btn-xs btn-link p-0">Mark read</button>
                    </form>
                  </div>
                </a>
              {% endfor %}
            {% else %}
              <div class="px-3 py-3 text-muted">No unread notifications.</div>
            {% endif %}
          </div>

          <div class="border-top">
            <a class="dropdown-item text-center" href="{% url 'notifications_list' %}">View all</a>
          </div>
        </div>
      </li>
      {# =================== / Notifications Bell ===================== #}

      <!-- User -->
      <li class="nav-item navbar-dropdown dropdown-user dropdown ms-2">
        <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
          <div class="avatar avatar-online">
            <i class="bx bx-md bx-user-circle"></i>
          </div>
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li>
            <a class="dropdown-item" href="#">
              <div class="d-flex">
                <div class="flex-shrink-0 me-3">
                  <div class="avatar avatar-online">
                    <i class="bx bx-md bx-user-circle"></i>
                  </div>
                </div>
                <div class="flex-grow-1">
                  <span class="fw-semibold d-block">{{ request.user.first_name }} {{ request.user.last_name }}</span>
                  <small class="text-muted">{{ request.user.role }}</small>
                </div>
              </div>
            </a>
          </li>
          <li><div class="dropdown-divider"></div></li>
          <li>
            <a class="dropdown-item" href="{% url 'customer_profile' %}">
              <i class="bx bx-user me-2"></i>
              <span class="align-middle">My Profile</span>
            </a>
          </li>
          <li><div class="dropdown-divider"></div></li>
          <li>
            <a class="dropdown-item" href="{% url 'logout' %}">
              <i class="bx bx-power-off me-2"></i>
              <span class="align-middle">Log Out</span>
            </a>
          </li>
        </ul>
      </li>
      <!--/ User -->
    </ul>
  </div>
</nav>
